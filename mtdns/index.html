<!doctype html>
<html lang="my" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DNS RECORD</title>
  <style>
    :root{
      --fg:#0b1220; --muted:#5b6b84; --line:#d8e3ee;

      /* Enhanced Color Palette - More vibrant and modern */
      --accent:#3b82f6;          /* Bright blue for IPs */
      --accent-ink:#1d4ed8;
      --ok:#10b981;              /* Emerald green for hostnames */
      --ok-bright:#059669;
      --warn:#f59e0b; --err:#ef4444;
      --purple:#8b5cf6;          /* Purple for accents */
      --teal:#06b6d4;            /* Teal for secondary */

      /* Enhanced gradient for buttons */
      --tri: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --tri-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
      --tri-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      --tri-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      --tri-secondary: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);

      /* Softer, more eye-pleasing background palette */
      --bg1:#f8fafc;   /* soft gray-blue */
      --bg2:#f0fdf4;   /* mint green */
      --bg3:#faf5ff;   /* lavender */
      --card:#ffffff; --card-tint:#f8fafc;

      --shadow-strong: 0 20px 40px rgba(11,18,32,.15);
      --shadow-soft:   0 8px 20px rgba(11,18,32,.08);
      --card-bg-plain:#ffffff;
      --table-row:#fff;
      --grain: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'>\
<filter id='f'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0'/><feComponentTransfer><feFuncA type='linear' slope='0.035'/></feComponentTransfer></filter>\
<rect width='100%' height='100%' filter='url(#f)'/>\
</svg>");
    }

    /* ===== Dark mode (soft deep tones) ===== */
    [data-theme="dark"]{
      --fg:#f1f5f9; --muted:#94a3b8; --line:#334155;
      --accent:#60a5fa; --accent-ink:#93c5fd;
      --ok:#34d399; --ok-bright:#34d399;
      --purple:#a78bfa; --teal:#67e8f9;
      --bg1:#0f172a;   /* deep blue-charcoal */
      --bg2:#052e16;   /* deep green */
      --bg3:#1e1b4b;   /* deep purple */
      --card:#1e293b; --card-tint:#0f172a;
      --warn:#fbbf24; --err:#f87171;
      --shadow-strong: 0 20px 40px rgba(0,0,0,.45);
      --shadow-soft:   0 8px 20px rgba(0,0,0,.35);
      --card-bg-plain:#1e293b;
      --table-row:#1e293b;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--fg);
      background:
        radial-gradient(1200px 700px at 15% 0%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1300px 800px at 90% 20%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#f8fafc 0%, #f0fbff 45%, #f9f5ff 100%);
      position:relative;
      min-height:100vh; display:flex; align-items:start; justify-content:center; padding:20px;
      transition: background .3s ease, color .2s ease;
    }
    body::after{
      content:""; position:fixed; inset:0; pointer-events:none;
      background-image: var(--grain);
      mix-blend-mode:multiply; opacity:.22;
    }
    [data-theme="dark"]{
      background:
        radial-gradient(1400px 700px at 10% -10%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1400px 800px at 100% 30%, var(--bg2) 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 110%, var(--bg3) 0%, transparent 50%),
        linear-gradient(160deg,#0f172a 0%, #1e1b4b 50%, #052e16 100%);
    }

    .wrap{width:100%;max-width:1040px;display:flex;flex-direction:column;gap:24px}

    /* Enhanced card with glassmorphism effect */
    .card{
      position:relative;
      background: linear-gradient(180deg,var(--card) 0%,var(--card-tint) 100%);
      backdrop-filter:blur(14px);
      border:1px solid var(--line); border-radius:24px;
      box-shadow:var(--shadow-strong); padding:32px 28px;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(11,18,32,.15);
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--tri);
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }

    /* Enhanced headings with icons */
    h1{font-size:36px;margin-bottom:8px;letter-spacing:.3px;background:var(--tri);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800;display:flex;align-items:center;gap:12px}
    h2{font-size:26px;margin-bottom:12px;letter-spacing:.2px;font-weight:700;display:flex;align-items:center;gap:10px}
    .byline{color:var(--accent-ink);font-weight:800;margin-bottom:16px;font-size:16px;display:flex;align-items:center;gap:8px}
    
    /* Icon styles */
    .icon{width:28px;height:28px;flex-shrink:0}
    .icon-sm{width:20px;height:20px}
    h1 .icon{width:36px;height:36px}
    h2 .icon{width:28px;height:28px}
    
    /* Enhanced form elements */
    form{display:grid;gap:16px}
    .row{display:grid;gap:10px;grid-template-columns:1fr;align-items:center}

    label{color:var(--muted);font-size:15px;font-weight:500;display:flex;align-items:center;gap:6px}
    input,select{
      width:100%;height:48px;padding:12px 16px;border:1px solid var(--line);border-radius:14px;
      font-size:16px;background:#fff;outline:none;transition:all 0.3s ease;
      color:#0b1220;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    [data-theme="dark"] input,[data-theme="dark"] select{
      background:#1e293b; color:var(--fg); border-color:#334155;
    }
    input:focus,select:focus{
      border-color:transparent;
      box-shadow:0 0 0 4px rgba(59,130,246,.18), inset 0 0 0 1.5px var(--accent), 0 5px 15px rgba(59,130,246,.1);
      transform: translateY(-2px);
    }
    .btns{display:flex;gap:12px;margin-top:8px;flex-wrap:wrap}

    /* Enhanced Buttons */
    button{
      height:48px;border-radius:14px;font-weight:800;letter-spacing:.2px;cursor:pointer;
      border:0; padding:0 20px;
      background-image:var(--tri); background-size:200% 100%;
      color:#fff;
      box-shadow:0 8px 20px rgba(11,18,32,.15);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      position: relative;
      overflow: hidden;
      display:flex;align-items:center;gap:8px;
    }
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    button:hover::before {
      left: 100%;
    }
    button:hover{transform:translateY(-3px); background-position:right center; filter:saturate(1.05); box-shadow:0 12px 25px rgba(11,18,32,.2)}
    button:active{transform:translateY(0)}

    /* Button variants */
    .btn-success{background-image:var(--tri-success)}
    .btn-warning{background-image:var(--tri-warning)}
    .btn-danger{background-image:var(--tri-danger)}
    .btn-secondary{background-image:var(--tri-secondary)}

    .btn-mini{height:36px;padding:0 14px;border-radius:12px;font-weight:700;font-size:14px}
    .row-actions .btn-mini{
      background-image:var(--tri); background-size:200% 100%; color:#fff; border:0;
    }
    .row-actions .btn-mini.ghost{
      background:transparent; color:transparent; border:2px solid transparent;
      background-image:var(--tri); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
      border-image: var(--tri) 1; box-shadow:0 6px 12px rgba(11,18,32,.08);
    }

    /* Enhanced Messages */
    #msg,#lookupMsg,#searchMsg{
      margin-top:12px;padding:16px;border-radius:14px;border:1px solid var(--line);
      background:#f8fafc;min-height:48px;white-space:pre-wrap; transition: all 0.3s ease;
      color:#0b1220;
    }
    [data-theme="dark"] #msg,[data-theme="dark"] #lookupMsg,[data-theme="dark"] #searchMsg{
      background:#1e293b; color:var(--fg); border-color:#334155;
    }
    
    /* Enhanced Footer */
    .footer{
      text-align:center;margin-top:2px;font-size:14px;color:var(--fg);background:var(--card-bg-plain);border:1px solid var(--line);
      border-radius:14px;padding:16px;box-shadow:var(--shadow-soft);
      position: relative;
      overflow: hidden;
      display:flex;align-items:center;justify-content:center;gap:8px;
    }
    .footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--tri);
      opacity: 0.7;
    }
    
    .msg-ok{border-color:var(--ok)!important;background:#ecfdf5!important}
    .msg-warn{border-color:var(--warn)!important;background:#fffbeb!important}
    .msg-err{border-color:var(--err)!important;background:#fef2f2!important}
    [data-theme="dark"] .msg-ok{background:#062814!important}
    [data-theme="dark"] .msg-warn{background:#2a1f06!important}
    [data-theme="dark"] .msg-err{background:#2a0b0b!important}

    /* Enhanced Toggle */
    .switch{position:relative;display:inline-flex;align-items:center;gap:10px;cursor:pointer;user-select:none}
    .switch input{position:absolute;opacity:0;width:0;height:0}
    .slider{
      position:relative;width:48px;height:26px;border-radius:999px;background:#e5e7eb;border:1px solid #d1d5db;
      transition:background .2s,border-color .2s,box-shadow .2s; box-shadow:inset 0 2px 4px rgba(0,0,0,.06)
    }
    [data-theme="dark"] .slider{ background:#1e293b; border-color:#334155; }
    .slider::after{
      content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;background:#fff;border-radius:999px;
      box-shadow:0 2px 6px rgba(0,0,0,.15);transition:all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)
    }
    [data-theme="dark"] .slider::after{ background:#f1f5f9; }
    .switch input:checked + .slider{
      background:#fde68a; border-color:#f59e0b; box-shadow:0 0 0 3px rgba(245,158,11,.25) inset;
    }
    .switch input:checked + .slider::after{left:23px; transform: scale(1.1);}

    .cf-note{font-size:13px;color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;border:1px solid var(--line);font-size:12px;color:var(--fg);background:#fff;margin-left:8px}
    [data-theme="dark"] .pill{ background:#1e293b; }

    /* Enhanced Table */
    .table-wrap{overflow-x:auto; -webkit-overflow-scrolling:touch}
    .table{width:100%;border-collapse:separate;border-spacing:0 10px;margin-top:10px;min-width:720px}
    .table thead th{text-align:left;font-size:13px;color:var(--muted);padding:0 12px;white-space:nowrap}
    .table tbody tr{
      background:var(--table-row);border:1px solid var(--line);border-radius:14px;overflow:hidden;
      box-shadow:0 4px 10px rgba(11,18,32,.05);
      transition: all 0.3s ease;
    }
    .table tbody tr:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(11,18,32,.1);
    }
    [data-theme="dark"] .table tbody tr{ box-shadow:0 4px 10px rgba(0,0,0,.35) }
    [data-theme="dark"] .table tbody tr:hover { box-shadow: 0 8px 20px rgba(0,0,0,.5) }
    .table td{padding:12px;font-size:14px;vertical-align:middle; color:var(--fg)}

    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
    .small{font-size:14px;color:var(--muted)}
    .row-actions{display:flex;gap:8px;flex-wrap:wrap}
    .inpt{height:36px;padding:8px 10px;border:1px solid var(--line);border-radius:10px;font-size:14px;width:100%}
    [data-theme="dark"] .inpt{ background:#1e293b; color:var(--fg); }
    .sel{height:36px;padding:0 10px;border:1px solid var(--line);border-radius:10px;font-size:14px;background:#fff}
    [data-theme="dark"] .sel{ background:#1e293b; color:var(--fg); }

    /* === Stronger selectors to beat `.table td` === */
    .table td.cell-name{ color: var(--ok-bright) !important; font-weight:700 !important; }
    .table td .cell-content.ip{ color: var(--accent) !important; font-weight:700 !important; }
    .table td .cell-content.host{ color: var(--ok-bright) !important; font-weight:700 !important; }

    /* New floating action button for theme toggle */
    .theme-fab{
      position:fixed; right:20px; bottom:20px; z-index:9999;
      width:56px; height:56px; border-radius:999px;
      display:inline-flex; align-items:center; justify-content:center;
      background-image:var(--tri); background-size:200% 100%;
      color:#fff; border:0;
      box-shadow:0 14px 30px rgba(59,130,246,.35);
      cursor:pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      animation: pulse 2s infinite;
    }
    .theme-fab:hover{ 
      transform: translateY(-5px) rotate(15deg); 
      filter:saturate(1.05); 
      background-position:right center; 
      box-shadow:0 20px 40px rgba(59,130,246,.5);
    }
    .theme-fab:active{ transform: translateY(0) }
    .theme-fab svg{ width:24px; height:24px }
    .icon-sun{ display:inline }
    .icon-moon{ display:none }
    [data-theme="dark"] .icon-sun{ display:none }
    [data-theme="dark"] .icon-moon{ display:inline }

    /* Pulse animation for the FAB */
    @keyframes pulse {
      0% { box-shadow: 0 14px 30px rgba(59,130,246,.35); }
      50% { box-shadow: 0 14px 30px rgba(59,130,246,.6), 0 0 0 10px rgba(59,130,246,.1); }
      100% { box-shadow: 0 14px 30px rgba(59,130,246,.35); }
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 480px){
      h1{font-size:28px}
      h2{font-size:22px}
      .table td{font-size:13px}
      button,.btn-mini{height:44px}
      .card{padding:24px 20px}
      .icon{width:24px;height:24px}
      h1 .icon{width:32px;height:32px}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- DNS Record -->
    <div class="card">
      <h1>
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="2" y1="12" x2="22" y2="12"></line>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        </svg>
        DNS RECORD
      </h1>

      <form id="dnsForm" autocomplete="off">
        <div class="row">
          <label for="type">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="16 18 22 12 16 6"></polyline>
              <polyline points="8 6 2 12 8 18"></polyline>
            </svg>
            Type
          </label>
          <select id="type" required>
            <option value="A">A</option>
            <option value="AAAA">AAAA</option>
            <option value="CNAME">CNAME</option>
            <option value="TXT">TXT</option>
            <option value="MX">MX</option>
            <option value="NS">NS</option>
            <option value="CAA">CAA</option>
            <option value="HTTPS">HTTPS</option>
          </select>
        </div>

        <div class="row">
          <label for="host">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"></path>
              <circle cx="12" cy="9" r="2.5"></circle>
            </svg>
            Host
          </label>
          <input id="host" type="text" placeholder="sub (or sub.dnstt.site)" required />
        </div>

        <div class="row">
          <label id="contentLabel" for="content">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
            IPv4 Address
          </label>
          <input id="content" type="text" placeholder="e.g. 203.0.113.10" required />
        </div>

        <div class="row" id="prioRow" style="display:none">
          <label for="priority">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            Priority
          </label>
          <input id="priority" type="number" min="0" max="65535" placeholder="10 (MX only)" />
        </div>

        <div class="row">
          <label for="ttl">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            TTL
          </label>
          <select id="ttl">
            <option value="1" selected>Auto</option>
            <option value="60">60</option>
            <option value="120">120</option>
            <option value="300">300</option>
            <option value="600">600</option>
            <option value="1800">1800</option>
            <option value="3600">3600</option>
          </select>
        </div>

        <!-- Proxy toggle -->
        <div class="row" id="proxiedRow">
          <label for="proxied">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Proxy through Cloudflare
          </label>
          <div>
            <label class="switch" aria-label="Proxy through Cloudflare">
              <input id="proxied" type="checkbox" checked />
              <span class="slider" aria-hidden="true"></span>
            </label>
            <span class="pill">
              <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 2H3v16h6l4 4 4-4h6V2z"></path>
              </svg>
              A / AAAA / CNAME only
            </span>
            <div class="cf-note">DNS ONLY ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ ·ÄÅ·Äú·ÄØ·Äê·Ä∫·ÄÄ·Ä≠·ÄØ ·Äï·Ä≠·Äê·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Åã</div>
          </div>
        </div>

        <div class="btns">
          <button type="submit" class="btn-success">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            Add / Update
          </button>
          <button type="button" id="resetBtn" class="btn-secondary">
            <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2.5 2v6h6M21.5 22v-6h-6"></path>
              <path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"></path>
            </svg>
            Reset
          </button>
        </div>
        <div id="msg"></div>

        <div class="small" style="margin-top:8px;display:flex;align-items:center;gap:6px">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          Host ·ÄÄ·Ä≠·ÄØ short (e.g. <span class="mono">app</span>) ·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫·Äõ·ÄÑ·Ä∫
          <span class="mono">app.dnstt.site</span> ·Äú·Ä≠·ÄØ append ·Äú·ÄØ·Äï·Ä∫·Äï·Ä±·Ä∏·Äô·Äö·Ä∫·Åã
        </div>
      </form>
    </div>

    <!-- Host to IP -->
    <div class="card">
      <h2>
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        Host to IP <span class="small">(Lookup)</span>
      </h2>
      <div class="row">
        <label for="lookupHost">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"></path>
            <circle cx="12" cy="9" r="2.5"></circle>
          </svg>
          Host
        </label>
        <input id="lookupHost" type="text" placeholder="sub (or full hostname)" />
      </div>
      <div class="btns" style="margin-top:12px">
        <button type="button" id="lookupBtn" class="btn-success">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          Lookup
        </button>
        <button type="button" id="lookupReset" class="btn-secondary">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          Clear
        </button>
      </div>
      <div id="lookupMsg"></div>
    </div>

    <!-- Cloudflare Search / Manage -->
    <div class="card">
      <h2>
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        Cloudflare DNS Records (Search / Edit / Delete)
      </h2>
      <div class="row">
        <label for="cfName">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          Search
        </label>
        <input id="cfName" placeholder="Search by name or content (partial match)" />
      </div>
      <div class="row">
        <label for="cfType">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="16 18 22 12 16 6"></polyline>
            <polyline points="8 6 2 12 8 18"></polyline>
          </svg>
          Type
        </label>
        <select id="cfType">
          <option value="">(Any)</option>
          <option>A</option><option>AAAA</option><option>CNAME</option>
          <option>TXT</option><option>MX</option><option>NS</option>
          <option>CAA</option><option>HTTPS</option>
        </select>
      </div>
      <div class="btns">
        <button type="button" id="cfSearch" class="btn-success">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          Search
        </button>
        <button type="button" id="cfClear" class="btn-secondary">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          Clear
        </button>
      </div>
      <div id="searchMsg" class="small" style="display:flex;align-items:center;gap:6px">
        <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        ·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·ÄÄ results ·ÄÄ Cloudflare ·Äô·Äæ ·Äê·Ä≠·ÄØ·ÄÄ·Ä∫·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫ query ·Äú·ÄØ·Äï·Ä∫·Äë·Ä¨·Ä∏·Äê·Ä¨·Äï·Ä´·Åã
      </div>

      <div class="table-wrap">
        <table class="table" aria-label="Cloudflare search results">
          <thead>
            <tr>
              <th>Type</th><th>Name</th><th>Content</th><th>TTL</th><th>Proxy</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="cfBody"></tbody>
        </table>
      </div>

      <div class="btns" style="justify-content:flex-end;margin-top:10px">
        <button class="btn-mini btn-secondary" id="prevPage">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Prev
        </button>
        <button class="btn-mini btn-secondary" id="nextPage">
          Next
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>

    <div class="footer">
      <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
      </svg>
      DNS Management System
    </div>
  </div>

  <!-- Theme toggle -->
  <button id="themeToggle" class="theme-fab" title="Dark/Light Toggle" aria-label="Toggle dark or light theme">
    <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="4"></circle>
      <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/>
    </svg>
    <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <script>
    /* === UPDATED DOMAIN & WORKER ENDPOINT === */
    const ROOT = "myshan.site";
    const API_BASE = "https://shan-dns.taitai-in-th.workers.dev";
    const API_URL  = API_BASE + "/dns";

    const typeEl=document.getElementById("type"),
      hostEl=document.getElementById("host"),
      contentEl=document.getElementById("content"),
      contentLabel=document.getElementById("contentLabel"),
      prioRow=document.getElementById("prioRow"),
      priorityEl=document.getElementById("priority"),
      proxiedRow=document.getElementById("proxiedRow"),
      proxiedEl=document.getElementById("proxied"),
      ttlEl=document.getElementById("ttl"),
      msg=document.getElementById("msg");

    (function initTheme(){
      try{
        const root = document.documentElement;
        const saved = localStorage.getItem("theme");
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initial = saved || (prefersDark ? "dark" : "light");
        root.setAttribute("data-theme", initial);
      }catch(e){}
    })();
    document.getElementById("themeToggle").addEventListener("click", ()=>{
      const root = document.documentElement;
      const cur = root.getAttribute("data-theme") || "light";
      const next = (cur === "light") ? "dark" : "light";
      root.setAttribute("data-theme", next);
      try{ localStorage.setItem("theme", next); }catch(e){}
    });

    async function fetchJSON(url, opt){
      const r = await fetch(url, opt);
      if(!r.ok) throw new Error(r.status);
      return r.json();
    }

    /* ===== Highlight helpers ===== */
    const ipV4Test = /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/i;
    const ipV6Test = /^(?:[A-Fa-f0-9]{1,4}:){1,7}[A-Fa-f0-9]{1,4}$/;
    const ipV4Match = /\b(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\b/g;
    const ipV6Match = /\b(?:[A-Fa-f0-9]{1,4}:){1,7}[A-Fa-f0-9]{1,4}\b/g;
    const hostMatch = /\b(?=.{1,253}\b)(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)(?:\.(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?))+\.?\b/gi;

    function isIP(val){
      const s = String(val||"").trim();
      return ipV4Test.test(s) || ipV6Test.test(s);
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])); }
    function escapeHtmlAttr(s){ return String(s).replace(/"/g,'&quot;'); }

    function highlightInline(text){
      let out = text.replace(ipV4Match, m=>`<span class="ip-accent mono">${m}</span>`);
      out = out.replace(ipV6Match, m=>`<span class="ip-accent mono">${m}</span>`);
      out = out.replace(hostMatch, m=>{
        if(ipV4Test.test(m) || ipV6Test.test(m)) return m;
        return `<span class="mono" style="color:var(--ok-bright);font-weight:800">${m}</span>`;
      });
      return out;
    }

    function show(kind, text, el=msg){
      el.innerHTML = highlightInline(String(text));
      el.className = "";
      el.classList.add(kind==="ok"?"msg-ok":kind==="warn"?"msg-warn":"msg-err");
    }

    function setPlaceholders(){
      const t=typeEl.value;
      prioRow.style.display=(t==="MX")?"grid":"none";
      proxiedRow.style.display=(["A","AAAA","CNAME"].includes(t))?"grid":"none";
      const placeholders={
        "A":["IPv4 Address","e.g. 203.0.113.10"],
        "AAAA":["IPv6 Address","e.g. 2001:db8::1"],
        "CNAME":["Target Hostname","e.g. target.example.com"],
        "TXT":["TXT Value",'e.g. v=spf1 include:_spf.example ~all'],
        "MX":["Mail Server","e.g. mail.example.com"],
        "NS":["Nameserver Host","e.g. ns1.example.com"],
        "CAA":["CAA Value",'e.g. 0 issue "letsencrypt.org"'],
        "HTTPS":["Value","HTTPS record value"]
      };
      const p=placeholders[t]; contentLabel.textContent=p[0]; contentEl.placeholder=p[1];
    }
    typeEl.addEventListener("change",setPlaceholders); setPlaceholders();

    function normalizeHost(raw){
      const v=(raw||"").trim().replace(/\s+/g,"");
      if(!v)return"";
      if(v===ROOT||v.endsWith("."+ROOT))return v.toLowerCase();
      if(v.includes(".")) return v.toLowerCase();
      return (v+"."+ROOT).toLowerCase();
    }

    document.getElementById("resetBtn").addEventListener("click",()=>{
      document.getElementById("dnsForm").reset(); setPlaceholders();
      msg.textContent=""; msg.className=""; hostEl.focus();
    });

    document.getElementById("dnsForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      
      // Add loading state
      submitBtn.innerHTML = '<div class="loading"></div> Processing...';
      submitBtn.disabled = true;
      
      const type=typeEl.value.trim().toUpperCase(),
        name=normalizeHost(hostEl.value),
        content=contentEl.value.trim(),
        ttl=parseInt(ttlEl.value,10)||300,
        proxied=!!proxiedEl.checked;

      if(!name){show("err","‚ùå Host required");return;}
      if(!(name===ROOT||name.endsWith("."+ROOT))){show("err",`‚ùå Host must be under ${ROOT}`);return;}
      if(!content){show("err","‚ùå Content required");return;}

      const payload={type,name,content,ttl};
      if(type==="MX"){
        const p=parseInt(priorityEl.value,10);
        if(Number.isNaN(p)){show("err","‚ùå MX priority required");return;}
        payload.priority=p;
      }
      if(["A","AAAA","CNAME"].includes(type)) payload.proxied=proxied;

      show("warn","Processing‚Ä¶");
      try{
        const res=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
        const data=await res.json();
        if(data.success){
          const r=data.record||data.result||{};
          const c = (r.content||content);
          const n = (r.name||name);
          show("ok",`Done ‚úÖ : ${c} ‚Üí ${n} (${data.action||'create'})`);
          await runSearch();
        }else{
          show("err","‚ùå Error: "+(data.error||"Unknown"));
        }
      }catch(err){ show("err","‚ùå Network error: "+err.message); }
      finally {
        // Restore button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

    /* ===== Lookup (DoH) ===== */
    const lookupHostEl=document.getElementById("lookupHost");
    const lookupMsg=document.getElementById("lookupMsg");
    document.getElementById("lookupReset").addEventListener("click", ()=>{ lookupHostEl.value=""; lookupMsg.textContent=""; lookupMsg.className=""; });
    document.getElementById("lookupBtn").addEventListener("click", lookup);
    lookupHostEl.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); lookup(); }});
    async function doh(name,type){
      const url=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(name)}&type=${type}`;
      const res=await fetch(url,{headers:{accept:"application/dns-json"}});
      if(!res.ok) throw new Error(`DoH ${type} failed (${res.status})`);
      return res.json();
    }
    function formatAnswers(ans=[]){ return ans?.filter(a=>a?.data).map(a=>a.data)||[]; }
    async function lookup(){
      const lookupBtn = document.getElementById("lookupBtn");
      const originalText = lookupBtn.innerHTML;
      
      // Add loading state
      lookupBtn.innerHTML = '<div class="loading"></div> Looking up...';
      lookupBtn.disabled = true;
      
      const name=normalizeHost(lookupHostEl.value);
      if(!name){show("err","‚ùå Host required",lookupMsg);return;}
      show("warn","Looking up‚Ä¶",lookupMsg);
      try{
        const [a4,a6]=await Promise.allSettled([doh(name,"A"),doh(name,"AAAA")]);
        const v4=(a4.status==="fulfilled")?formatAnswers(a4.value?.Answer):[];
        const v6=(a6.status==="fulfilled")?formatAnswers(a6.value?.Answer):[];
        if(v4.length===0 && v6.length===0){ show("err",`No A/AAAA answers for ${name}`,lookupMsg); return; }
        const chunks=[];
        if(v4.length) chunks.push(`A (${v4.length}) ‚Üí ${v4.map(ip=>`<span class="cell-content ip mono">${ip}</span>`).join(", ")}`);
        if(v6.length) chunks.push(`AAAA (${v6.length}) ‚Üí ${v6.map(ip=>`<span class="cell-content ip mono">${ip}</span>`).join(", ")}`);
        lookupMsg.className="msg-ok";
        lookupMsg.innerHTML = `<span class="cell-content host mono">${name}</span>\n${chunks.join("\n")}`;
      }catch(err){ show("err","‚ùå Lookup error: "+err.message,lookupMsg); }
      finally {
        // Restore button state
        lookupBtn.innerHTML = originalText;
        lookupBtn.disabled = false;
      }
    }

    /* ===== Cloudflare Search / Manage ===== */
    const cfName=document.getElementById("cfName");
    const cfType=document.getElementById("cfType");
    const cfBody=document.getElementById("cfBody");
    const searchMsg=document.getElementById("searchMsg");
    document.getElementById("cfClear").addEventListener("click",()=>{ cfName.value=""; cfType.value=""; page=1; runSearch(); });
    document.getElementById("cfSearch").addEventListener("click",()=>{ page=1; runSearch(); });
    document.getElementById("prevPage").addEventListener("click", ()=>{ if(page>1){ page--; runSearch(); }});
    document.getElementById("nextPage").addEventListener("click", ()=>{ page++; runSearch(); });

    let page=1;
    function classifyContent(val){
      return isIP(val) ? 'ip' : 'host';
    }
    async function runSearch(){
      const searchBtn = document.getElementById("cfSearch");
      const originalText = searchBtn.innerHTML;
      
      // Add loading state
      searchBtn.innerHTML = '<div class="loading"></div> Searching...';
      searchBtn.disabled = true;
      
      const params=new URLSearchParams();
      if(cfName.value.trim()) params.set("name", cfName.value.trim());
      if(cfType.value) params.set("type", cfType.value);
      params.set("page", String(page));
      params.set("per_page","50");
      searchMsg.textContent="Searching‚Ä¶"; searchMsg.className="msg-warn";

      try{
        const res=await fetch(`${API_URL}?${params.toString()}`,{method:"GET"});
        const data=await res.json();
        if(!data.success){ throw new Error(data.error||"Search failed"); }
        const rows=data.result||[];
        cfBody.innerHTML="";
        if(rows.length===0){
          cfBody.innerHTML=`<tr><td colspan="6" class="small">No records found on this page.</td></tr>`;
        }else{
          for(const r of rows){
            const tr=document.createElement("tr");
            const contentClass = classifyContent(r.content||"");
            const contentHTML = contentClass==='ip'
              ? `<span class="cell-content ip mono">${escapeHtml(r.content||"")}</span>`
              : `<span class="cell-content host mono">${escapeHtml(r.content||"")}</span>`;
            tr.innerHTML = `
              <td class="cell-type"><span class="mono">${r.type||""}</span></td>
              <td class="cell-name mono">${escapeHtml(r.name||"")}</td>
              <td class="cell-content-wrap">${contentHTML}</td>
              <td class="cell-ttl">${r.ttl||""}</td>
              <td class="cell-prox">${(["A","AAAA","CNAME"].includes(r.type) && r.proxied)? "üü© proxied":"‚¨ú DNS only"}</td>
              <td class="cell-act">
                <div class="row-actions">
                  <button class="btn-mini" data-act="edit" data-id="${r.id}">
                    <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Edit
                  </button>
                  <button class="btn-mini" data-act="load" data-id="${r.id}">
                    <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Load
                  </button>
                  <button class="btn-mini ghost" data-act="delete" data-id="${r.id}">
                    <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Delete
                  </button>
                </div>
              </td>`;
            tr.dataset.row = JSON.stringify(r);
            cfBody.appendChild(tr);
          }
        }
        searchMsg.textContent=`Page ${data.page||page} ‚Äì ${rows.length} record(s)`; searchMsg.className="small";
      }catch(err){
        searchMsg.textContent="‚ùå "+err.message;
        searchMsg.className="msg-err";
      }
      finally {
        // Restore button state
        searchBtn.innerHTML = originalText;
        searchBtn.disabled = false;
      }
    }
    runSearch();

    function typeSelectHTML(cur){
      const types=["A","AAAA","CNAME","TXT","MX","NS","CAA","HTTPS"];
      return `<select class="sel edit-type">
        ${types.map(t=>`<option value="${t}" ${t===cur?'selected':''}>${t}</option>`).join("")}
      </select>`;
    }
    function proxToggleHTML(checked){
      return `<label class="switch switch-mini">
        <input class="edit-prox" type="checkbox" ${checked?'checked':''} />
        <span class="slider"></span>
      </label>`;
    }
    function startEdit(tr, row){
      if(tr.dataset.editing==="1") return;
      tr.dataset.editing="1";

      tr.querySelector(".cell-type").innerHTML = typeSelectHTML(row.type||"A");
      tr.querySelector(".cell-name").innerHTML = `<input class="inpt edit-name" value="${escapeHtmlAttr(row.name||"")}" />`;
      tr.querySelector(".cell-content-wrap").innerHTML = `<input class="inpt edit-content" value="${escapeHtmlAttr(row.content||"")}" />`;
      tr.querySelector(".cell-ttl").innerHTML = `<input class="inpt edit-ttl" type="number" min="1" value="${row.ttl||300}" />`;

      const proxCell = tr.querySelector(".cell-prox");
      if(["A","AAAA","CNAME"].includes(row.type||"")){
        proxCell.innerHTML = proxToggleHTML(!!row.proxied);
      }else{
        proxCell.innerHTML = `<span class="small muted">‚Äî</span>`;
      }

      const actCell = tr.querySelector(".cell-act .row-actions");
      actCell.innerHTML = `
        <button class="btn-mini btn-success" data-act="save" data-id="${row.id}">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          Save
        </button>
        <button class="btn-mini ghost" data-act="cancel" data-id="${row.id}">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          Cancel
        </button>
      `;
    }
    function cancelEdit(tr, row){
      tr.dataset.editing="0";
      tr.querySelector(".cell-type").innerHTML = `<span class="mono">${row.type||""}</span>`;
      tr.querySelector(".cell-name").innerHTML = `${escapeHtml(row.name||"")}`;
      const cls = isIP(row.content||"") ? 'ip' : 'host';
      tr.querySelector(".cell-content-wrap").innerHTML =
        cls==='ip'
          ? `<span class="cell-content ip mono">${escapeHtml(row.content||"")}</span>`
          : `<span class="cell-content host mono">${escapeHtml(row.content||"")}</span>`;
      tr.querySelector(".cell-ttl").innerHTML = `${row.ttl||""}`;
      tr.querySelector(".cell-prox").innerHTML =
        (["A","AAAA","CNAME"].includes(row.type) && row.proxied) ? "üü© proxied" : "‚¨ú DNS only";
      const actCell = tr.querySelector(".cell-act .row-actions");
      actCell.innerHTML = `
        <button class="btn-mini" data-act="edit" data-id="${row.id}">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Edit
        </button>
        <button class="btn-mini" data-act="load" data-id="${row.id}">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Load
        </button>
        <button class="btn-mini ghost" data-act="delete" data-id="${row.id}">
          <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Delete
        </button>
      `;
    }

    async function saveEdit(tr, row){
      const t = tr.querySelector(".edit-type").value;
      const nameRaw = tr.querySelector(".edit-name").value;
      const content = tr.querySelector(".edit-content").value.trim();
      const ttl = parseInt(tr.querySelector(".edit-ttl").value,10) || row.ttl || 300;
      const name = normalizeHost(nameRaw);

      if(!name){searchMsg.textContent="‚ùå Host required"; searchMsg.className="msg-err"; return;}
      if(!content){searchMsg.textContent="‚ùå Content required"; searchMsg.className="msg-err"; return;}

      const payload = { type:t, name, content, ttl };
      if(t==="MX"){ payload.priority = (row.priority!=null) ? row.priority : 10; }
      if(["A","AAAA","CNAME"].includes(t)){
        const prox = tr.querySelector(".edit-prox");
        payload.proxied = prox ? !!prox.checked : false;
      }

      searchMsg.textContent="Saving‚Ä¶"; searchMsg.className="msg-warn";
      try{
        const res=await fetch(`${API_URL}/${row.id}`,{
          method:"PUT", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(payload)
        });
        const data=await res.json();
        if(!data.success) throw new Error(data.error||"Update failed");
        searchMsg.textContent="Updated ‚úÖ"; searchMsg.className="msg-ok";
        await runSearch();
      }catch(err){
        searchMsg.textContent="‚ùå "+err.message; searchMsg.className="msg-err";
      }
    }

    document.getElementById("cfBody").addEventListener("click", async (e)=>{
      const btn=e.target.closest("button"); if(!btn) return;
      const act=btn.getAttribute("data-act");
      const tr=btn.closest("tr");
      const row=JSON.parse(tr.dataset.row||"{}");

      if(act==="load"){
        typeEl.value=row.type||"A"; setPlaceholders();
        hostEl.value=row.name||"";
        contentEl.value=row.content||"";
        ttlEl.value=String(row.ttl||300);
        if(["A","AAAA","CNAME"].includes(row.type||"")) proxiedEl.checked=!!row.proxied;
        if(row.type==="MX" && row.priority!=null){ priorityEl.value = row.priority; }
        show("ok","Loaded into form. Edit and click \"Add / Update\".");
        window.scrollTo({top:0,behavior:"smooth"});
      }

      if(act==="edit"){ startEdit(tr, row); }
      if(act==="cancel"){ cancelEdit(tr, row); }
      if(act==="save"){ await saveEdit(tr, row); }

      if(act==="delete"){
        if(!confirm(`Delete DNS record?\n${row.type} ${row.name} -> ${row.content}`)) return;
        searchMsg.textContent="Deleting‚Ä¶"; searchMsg.className="msg-warn";
        try{
          const res=await fetch(`${API_URL}/${row.id}`,{method:"DELETE"});
          const data=await res.json();
          if(!data.success) throw new Error(data.error||"Delete failed");
          searchMsg.textContent="Deleted ‚úÖ"; searchMsg.className="msg-ok";
          await runSearch();
        }catch(err){ searchMsg.textContent="‚ùå "+err.message; searchMsg.className="msg-err"; }
      }
    });
  </script>
</body>
  </html>
